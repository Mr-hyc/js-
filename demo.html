<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>瀑布流布局代码</title>
</head>
<style type="text/css" media="screen">
    *{
        margin:0;
        padding:0;
    }
    div{
        width: 200px;
        background: #ccc;
        position: absolute;
        transition:0.5s;
    }
</style>
<body>
    <script type="text/javascript" charset="utf-8">
        createDiv();
        //创建div函数
        function createDiv(){
            for (var i = 1; i <= 40; i++) {                            //循环创建40个div
                var Div=document.createElement('div');      //在dom创建div
                var DivH=Math.floor(Math.random()*300+50);   //产生50~300的随机数用作div的高度
                Div.style.height=DivH+'px';
                Div.innerHTML=i;                             //把产生的高度赋值给div
                document.body.appendChild(Div);                     //把创建的div追加到body元素中
            };
            arrangeDiv();
        }
        //div排列函数
        function arrangeDiv(){
            console.log(num);
            var AllDiv=document.getElementsByTagName('div');   //获取页面创建所有的div
            var windowWidth=document.body.clientWidth;    //获取浏览器的可是宽度
            var num=Math.floor(windowWidth/210);   //通过窗口的宽度÷每个div的宽度得到一行所能容纳的个数       210：div的宽度200+div的边距10）。Math.floor：取整
            var cenShow=(windowWidth-num*210)/2   //让整个div居中显示（可视宽度-div总宽度）÷2
            var arrayH=[]    //这里我们定义一个数组用来存储div的高度
            for (var i = 0; i <AllDiv.length; i++) {    //通过循环让每一个div都输出
                if (i<num) {         //如果i<num说明这是第一行
                    AllDiv[i].style.left=cenShow+i*200+10*i+'px';     //通过i值得增加，给第一排的div赋值left值
                    AllDiv[i].style.top='0px';    //因为是第一排，所以他们的高度都为0；
                    arrayH[i]=AllDiv[i].offsetHeight        //将第一行div的高度存储到数组中
                    //console.log(arrayH)       //通过打印可以看出每一个div高度具体值
                }else{
                    var minKey=findMinKey(arrayH);          //把健值赋值给minKey变量
                    AllDiv[i].style.top=arrayH[minKey]+10+'px';   
                    AllDiv[i].style.left=cenShow+200*minKey+10*minKey+'px';
                    arrayH[minKey]+=AllDiv[i].offsetHeight +10;      //将新的div高度存放到arrayH数组中
                }
            };
        }
        //查询第二排第一个位置对应上一排的键
        function findMinKey(Arr){
            var minNum=Math.min.apply(null,Arr);      //取出上一排数组中最小的那个值 打印查看效果
            var k=0;                                                    //获取数组中这个最小值对应的健
            for(k in Arr){
                if (Arr[k] == minNum) {
                    return k;
                };

            }
        }

        //当窗口发生变化时调用
        window.onresize = function(){
            arrangeDiv();
        }
        //当滚动条滑动到指定位置时，执行在加载
        window.onscroll = function(){
            var windowHeight=document.documentElement.clientHeight;      //获取页面可视高度
            var scrollTop=document.documentElement.scrollTop || document.body.scrollTop;     //获取页面滚动条的滚动高度
            var scrollHeight=document.body.scrollHeight   //获取页面滚动条的总高度
            if (windowHeight+scrollTop >= scrollHeight-50) {     //如果页面滑动到底部 再次执行创建
                createDiv();
            };
        }
    </script>
</body>
</html>